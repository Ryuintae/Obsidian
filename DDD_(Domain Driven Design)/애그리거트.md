
## **애그리거트란?**

애그리거트는 **특정 도메인에 관련된 엔티티와 밸류 객체들의 묶음**입니다.

프로그래밍 세계에선 항상 극단적으로 생각해볼 필요가 있습니다.

특정 시스템에 구성된 객체가 10억 개가 있다면 개발자가 미로같이 얽힌 시스템을 이해하기 매우 어려울겁니다.

따라서 애그리거트 단위로 도메인을 관리하면 객체 수준이 아닌 상위 수준에서 시스템을 바라볼 수 있어서 개발자가 시스템을 이해하기 쉽게 됩니다.


## **애그리거트 설계 원칙**

1. **한 애그리거트에 속한 객체는 동일한 라이프 사이클를 가짐**
2. **애그리거트 루트를 통한 일관성 보장**
3. **ID를 통해 애그리거트간 참조**

![](https://blog.kakaocdn.net/dn/kxCy8/btrb7zxZ0nv/BhHKH3JuZKMAF36hvEhZq0/img.png)

애그리거트는 동일한 라이프 사이클을 가진 객체들끼리 묶는 것을 원칙으로 합니다.

온라인 쇼핑몰을 예를 들면, 상품 주문 Aggregate, 결제 Aggregate, 상품 Aggregate, 회원 Aggregate, 리뷰 Aggregate 등으로 나눌 수 있습니다.

각각의 Aggregate는 생성되고 종료되는 시점(라이프사이클)을 고려하여 분류되었습니다.

주의할 점은 단순히 'A가 B를 갖는다'라고 해서 A와 B를 한 애그리거트로 묶을 수 없다는 것입니다.

상품은 리뷰 정보를 갖지만 상품 등록 주체는 상품 담당자이고 리뷰 등록 주체는 소비자이며 둘의 라이프 사이클 또한 다르기 때문에 다른 애그리거트에 속합니다.

도메인 모델에 능숙해질수록 한 애그리거트를 하나의 엔티티로 구성하게 됩니다.

## **애그리거트 루트**

애그리거트 루트는 **루트 엔티티**라고도 부르며, 애그리거트 전체를 관리하는 주체입니다.

애그리거트에 속한 객체들은 루트 엔티티에 직/간접적으로 속합니다.

애그리거트 루트의 핵심은 **애그리거트의 일관성이 깨지지 않도록 하는 것**입니다.

외부의 접근을 막고 애그리거트 루트를 통해서만 객체의 상태를 변경하며, 핵심 도메인 로직은 애그리거트 루트에 위치합니다.

## 애그리거트 경험 법칙

1. 애그리거트 경계 내에서 비즈니스 불변사항들을 보호하라.
2. 작은 애그리거트를 설계하라.
3. 오직 ID 를 통해 다른 애그리거트를 참고하라.
4. 결과적 일관성을 사용해 다른 애그리거트를 갱신하라.
